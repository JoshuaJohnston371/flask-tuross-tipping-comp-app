{% extends "base.html" %}
{% block content %}
<div class="container mt-4 p-4 rounded bg-dark">
  <h1 class="text-center mb-4">Admin Dashboard - Round {{ round }}</h1>

  <!-- Tabs Navigation -->
  <ul class="nav nav-tabs mb-3" id="adminTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active" id="user-tips-tab" data-bs-toggle="tab" href="#user-tips" role="tab" aria-controls="user-tips" aria-selected="true">
        User Tips
      </a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="register-tab" data-bs-toggle="tab" href="#register" role="tab" aria-controls="register" aria-selected="false">
        Register User
      </a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="change-username-tab" data-bs-toggle="tab" href="#change-username" role="tab" aria-controls="change-username" aria-selected="false">
        Change Username
      </a>
    </li>
  </ul>

  <!-- Tabs Content -->
  <div class="tab-content" id="adminTabContent">
    <!-- User Tips Tab -->
    <div class="tab-pane fade show active" id="user-tips" role="tabpanel" aria-labelledby="user-tips-tab">
      <table class="table table-bordered text-white">
        <thead class="table-light text-dark">
          <tr>
            <th>User</th>
            <th>Has Tipped?</th>
            <th>Tips Submitted</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.username }}</td>
            <td>
              {% if tips_by_user[user.id]|length > 0 %}
                ✅
              {% else %}
                ❌
              {% endif %}
            </td>
            <td>
              {% for tip in tips_by_user[user.id] %}
                Match ID {{ tip.match }} → {{ tip.selected_team }}<br>
              {% endfor %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Register User Tab -->
    <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
      <div class="mt-3 text-white">
        {% if register_success %}
          <div class="alert alert-success text-center">User created successfully.</div>
        {% elif register_error %}
          <div class="alert alert-danger text-center">{{ register_error }}</div>
        {% endif %}

        <form method="POST" class="mt-3">
          <input type="hidden" name="action" value="register_user" />
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Full name" />
          </div>
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username" required />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" required />
          </div>
          <div class="mb-3">
            <label for="phone_number" class="form-label">Phone number</label>
            <input type="text" class="form-control" id="phone_number" name="phone_number" placeholder="Optional" />
          </div>
          <div class="mb-3">
            <label for="avatar" class="form-label">Avatar</label>
            <select class="form-select" id="avatar" name="avatar">
              <option value="">Default</option>
              {% for avatar in avatars %}
                <option value="{{ avatar }}">{{ avatar }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary w-100">Create user</button>
        </form>
      </div>
    </div>

    <!-- Change Username Tab -->
    <div class="tab-pane fade" id="change-username" role="tabpanel" aria-labelledby="change-username-tab">
      <div class="mt-3">
        {% include "change_username.html" %}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var tabLinks = document.querySelectorAll('#adminTab [data-bs-toggle="tab"]');
    var tabPanes = document.querySelectorAll("#adminTabContent .tab-pane");

    tabLinks.forEach(function (link) {
      link.addEventListener("click", function (event) {
        event.preventDefault();
        var targetSelector = link.getAttribute("href") || link.getAttribute("data-bs-target");
        if (!targetSelector) {
          return;
        }

        tabLinks.forEach(function (item) {
          item.classList.remove("active");
          item.setAttribute("aria-selected", "false");
        });
        tabPanes.forEach(function (pane) {
          pane.classList.remove("show", "active");
        });

        var targetPane = document.querySelector(targetSelector);
        if (targetPane) {
          link.classList.add("active");
          link.setAttribute("aria-selected", "true");
          targetPane.classList.add("show", "active");
        }
      });
    });
  });
</script>
{% endblock %}


